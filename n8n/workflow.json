{
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "linebot/headache",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [-1400, 4060],
      "id": "1b358cbc-9539-4744-bc0d-55b1f5b6b346",
      "name": "Webhook",
      "webhookId": "adc81d3b-5694-4b97-8707-700d4e5cecc7"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.events[0].type }}",
                    "rightValue": "postback",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "b0083c5d-f530-4533-849f-783924bbd341"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "postback"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "82a1ba46-2be0-4723-91a3-5fe0a2b1b85e",
                    "leftValue": "={{ $json.body.events[0].type }}",
                    "rightValue": "message",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "message"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [-800, 4060],
      "id": "4508b9bf-135c-40ca-a1b6-91eaf59a1979",
      "name": "Switch"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "51a9606b-ae3f-474d-973c-d642536d7ce1",
              "name": "message",
              "value": "{   \"type\": \"template\",\n    \"altText\": \"ÂêÉ‰∫Ü‰ªÄÈ∫ºËó•\",\n    \"template\": {\n        \"type\": \"buttons\",\n        \"thumbnailImageUrl\": \"https://storage.morningstella.com/api/v1/buckets/public/objects/download?preview=true&prefix=general_questions.png&version_id=null\",\n        \"imageAspectRatio\": \"square\",\n        \"imageSize\": \"cover\",\n        \"title\": \"ÂêÉ‰∫Ü‰ªÄÈ∫ºËó•\",\n        \"text\": \"Ë´ãÈÅ∏Êìá‰∏ÄÁ®Æ\",\n        \"actions\": [\n            {\n                \"type\": \"postback\",\n                \"label\": \"ÂêÉ‰∫ÜÊôÆÊãøÁñº\",\n                \"text\": \"ÂêÉ‰∫ÜÊôÆÊãøÁñº\",\n                \"data\": \"drug_type=ÊôÆÊãøÁñº\"\n            },\n            {\n                \"type\": \"postback\",\n                \"label\": \"ÂêÉ‰∫Ü‰ºäÊôÆ\",\n                \"text\": \"ÂêÉ‰∫Ü‰ºäÊôÆ\",\n                \"data\": \"drug_type=‰ºäÊôÆ\"\n            },\n            {\n                \"type\": \"postback\",\n                \"label\": \"ÂêÉ‰∫ÜËÇåËÇâÈ¨ÜÂºõ\",\n                \"text\": \"ÂêÉ‰∫ÜËÇåËÇâÈ¨ÜÂºõ\",\n                \"data\": \"drug_type=ËÇåËÇâÈ¨ÜÂºõ\"\n            },\n            {\n                \"type\": \"postback\",\n                \"label\": \"ÂêÉ‰∫Ü‰∏≠Ëó•\",\n                \"text\": \"ÂêÉ‰∫Ü‰∏≠Ëó•\",\n                \"data\": \"drug_type=‰∏≠Ëó•\"\n            }\n        ]\n    }\n}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [-380, 4780],
      "id": "725647be-d37a-4642-860f-31b776d9065f",
      "name": "Set Drug Select"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"replyToken\":  \"{{ $('Webhook').item.json.body.events[0].replyToken }}\",\n  \"messages\":[{{ $json.message }}\n]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [3220, 4020],
      "id": "ebc33535-b653-46ef-9cb6-de69dfbc3ea5",
      "name": "Response Drug Select",
      "credentials": {
        "httpBearerAuth": {
          "id": "iNt070KxORzF3SpI",
          "name": "Line Auth Token"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.events[0].message.text }}",
                    "rightValue": "ÂêÉËó•‰∫Ü",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "5ee35c6f-84c5-423c-b446-e74bff580492"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ÂêÉËó•"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "f56d3cde-d045-4911-9bd4-948b3f1a843c",
                    "leftValue": "={{ $json.body.events[0].message.text }}",
                    "rightValue": "=È†≠Áóõ‰∫Ü",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "È†≠Áóõ"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "bd2f8573-6285-49af-9a80-800336668265",
                    "leftValue": "={{ $json.body.events[0].message.text }}",
                    "rightValue": "ÊúÄËøëÂêÉËó•",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ÊúÄËøëÂêÉËó•"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "567a697b-8a03-481a-a95f-e861452a717d",
                    "leftValue": "={{ $json.body.events[0].message.text }}",
                    "rightValue": "Êé°ÂèñË°åÂãï",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Êé°ÂèñË°åÂãï"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "7364b61c-c126-4307-926d-8d87d1893d13",
                    "leftValue": "={{ $json.body.events[0].message.text }}",
                    "rightValue": "È†≠‰∏çÁóõ‰∫Ü",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "È†≠‰∏çÁóõ‰∫Ü"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b6b32546-7312-4cd2-bc6e-a99fba0c6fb6",
                    "leftValue": "={{ $json.body.events[0].message.text }}",
                    "rightValue": "ÊúÄËøëÈ†≠Áóõ",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ÊúÄËøëÈ†≠ÁóõÊôÇÈñì"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [-960, 5060],
      "id": "9ec07937-ec72-407a-983b-a2d290436f26",
      "name": "Determine Response Action"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.drug_type }}",
                    "rightValue": "drug",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    },
                    "id": "6b24bb20-5d45-4b84-9c6f-574bdc5f5483"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "response drug number"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "c3d29e35-8353-404a-9668-72bcf7c5ea08",
                    "leftValue": "={{ $json.drug_number }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "responses drug datetime"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "98088412-70f4-4e62-8e62-282f6dfae893",
                    "leftValue": "={{ $json.drug_datetime }}",
                    "rightValue": "now",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "medicine now"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "86e614e5-f263-4a40-a330-485a85c8277f",
                    "leftValue": "={{ $json.pain_level }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "write pain level"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "47044a4e-970c-453a-8d07-9b671652194a",
                    "leftValue": "={{ $json.headache_occur }}",
                    "rightValue": "now",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "headache now"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "caf05b0c-9b01-4aed-bfcd-eefba2c2132c",
                    "leftValue": "={{ $json.headache_occur }}",
                    "rightValue": "selecttime",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "headache select time"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "cf06cf4f-66be-45c9-8fcb-be1ba4590a6d",
                    "leftValue": "={{ $json.action_occur }}",
                    "rightValue": "now",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "action occur now"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d15ce113-b4cb-4c1a-a15d-99d9e502dad0",
                    "leftValue": "={{ $json.action_occur }}",
                    "rightValue": "selecttime",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "action select time"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1833c35e-dda8-4901-ac5c-6368622db30f",
                    "leftValue": "={{ $json.no_headache_occur }}",
                    "rightValue": "now",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "no headache now"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "9f4235aa-31bf-4562-acc4-49c7d256d426",
                    "leftValue": "={{ $json.no_headache_occur }}",
                    "rightValue": "selecttime",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "no headache select time"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "7aa61cad-5c79-4dae-baf5-4f1d365c091d",
                    "leftValue": "={{ $json.headache_where }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "select headache where again"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fc7130a9-d548-4b89-9bfe-0378638c040c",
                    "leftValue": "={{ $json.headache_ask }}",
                    "rightValue": "done",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "headache ask done"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "87fee6fa-bdb8-4c63-8836-0155d0e67b67",
                    "leftValue": "={{ $json.drug_datetime }}",
                    "rightValue": "selecttime",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "medicine selecttime"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [780, 4000],
      "id": "7328ad1d-ee87-4cf6-9ba4-9ad1a7978bf1",
      "name": "Switch1"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json.body.events[0].postback.data;\n\n// Use a single regex to capture key-value pairs for both long (--key=value) and short (-k=value) options\nconst regex = /([a-zA-Z0-9_]+)=([^\\s]*)/gu;\n\nlet matches;\nlet drug_type = null;\nlet drug_type_tmp = null;\nlet drug_number = null;\nlet drug_number_tmp = null;\nlet drug_datetime = null;\nlet pain_level = null;\nlet pain_level_tmp = null;\nlet headache_occur = null;\nlet headache_occur_tmp = null;\nlet action_occur = null;\nlet action = null;\nlet no_headache_occur = null;\nlet headache_where = null;\nlet headache_where_final = null;\nlet headache_ask = null;\n\n// Loop through the matches\nwhile ((matches = regex.exec(input)) !== null) {\n    const key = matches[1] || matches[3]; // Get long option name or short key\n    var value = matches[2] || matches[4]; // Get the associated value\n    value = value?.trimEnd()\n    // Assign to the appropriate variable based on the key\n    if (key === 'drug_type') {\n        drug_type = value;\n    } else if (key === 'drug_number') {\n        drug_number = value;\n    } else if (key === 'drug_datetime') {\n      drug_datetime = value;\n    } else if (key === 'drug_type_tmp') {\n      drug_type_tmp = value\n    } else if (key === 'drug_number_tmp') {\n      drug_number_tmp = value\n    } else if (key === 'pain_level') {\n      pain_level = value\n    } else if (key === 'pain_level_tmp') {\n      pain_level_tmp = value\n    } else if (key === 'headache_occur') {\n      headache_occur = value\n    } else if (key === 'headache_occur_tmp') {\n      headache_occur_tmp = value\n    } else if (key === 'action_occur') {\n      action_occur = value\n    } else if (key === 'action') {\n      action = value\n    } else if (key === 'no_headache_occur') {\n      no_headache_occur = value\n    } else if (key === 'headache_where') {\n      headache_where = value\n    } else if (key === 'headache_where_final') {\n      headache_where_final = value\n    } else if (key === 'headache_ask') {\n      headache_ask = value\n    }\n}\n\n// Return the results\nreturn { drug_datetime, drug_number, drug_type, drug_type_tmp, drug_number_tmp, pain_level, headache_occur, headache_occur_tmp, action_occur, action, no_headache_occur, headache_where, headache_where_final, pain_level_tmp, headache_ask };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [600, 4200],
      "id": "b6583dd7-3ad8-45a3-b638-fc7ac2dc57ab",
      "name": "Code"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "51a9606b-ae3f-474d-973c-d642536d7ce1",
              "name": "message",
              "value": "={\n  \"type\": \"template\",\n  \"altText\": \"ÂêÉ‰∫ÜÂπæÈ°Ü\",\n  \"template\": {\n    \"type\": \"buttons\",\n    \"thumbnailImageUrl\": \"https://storage.morningstella.com/api/v1/buckets/public/objects/download?preview=true&prefix=general_questions.png&version_id=null\",\n    \"imageAspectRatio\": \"square\",\n    \"imageSize\": \"cover\",\n    \"title\": \"ÂêÉ‰∫ÜÂπæÈ°ÜËó•\",\n    \"text\": \"ÂõõÂ∞èÊôÇÂè™ËÉΩÂêÉ‰∏ÄÈ°Ü!\",\n    \"actions\": [\n      {\n        \"type\": \"postback\",\n        \"label\": \"1\",\n        \"text\": \"ÂêÉ‰∫Ü1È°Ü\",\n        \"data\": \"drug_number=1 drug_type_tmp={{$json.drug_type}}\"\n      },\n      {\n        \"type\": \"postback\",\n        \"label\": \"2\",\n        \"text\": \"ÂêÉ‰∫Ü2È°Ü\",\n        \"data\": \"drug_number=2 drug_type_tmp={{$json.drug_type}}\"\n      }\n    ]\n  }\n}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1560, 3700],
      "id": "85925739-8f2c-48ad-bb02-bcbb173a7f7d",
      "name": "Set Drug Number"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "6b262a70-2015-4722-9bcc-131f673f88ec",
              "name": "=message",
              "value": "={\n  \"type\": \"template\",\n  \"altText\": \"‰ªÄÈ∫ºÊôÇÂÄôÂêÉËó•ÁöÑ?\",\n  \"template\": {\n    \"type\": \"buttons\",\n    \"thumbnailImageUrl\": \"https://storage.morningstella.com/api/v1/buckets/public/objects/download?preview=true&prefix=general_questions.png&version_id=null\",\n    \"imageAspectRatio\": \"square\",\n    \"title\": \"‰ªÄÈ∫ºÊôÇÂÄôÂêÉÁöÑ\",\n    \"text\": \"Ë¶ÅË®òÈåÑÂî∑\",\n    \"actions\": [\n      {\n        \"type\": \"postback\",\n        \"label\": \"Â∞±ÊòØÁèæÂú®ÂêÉ‰∫Ü\",\n        \"text\": \"Â∞±ÊòØÁèæÂú®\",\n        \"data\": \"drug_datetime=now drug_type_tmp={{$json.drug_type_tmp}} drug_number_tmp={{$json.drug_number}}\"\n      },\n      {\n        \"type\": \"datetimepicker\",\n        \"label\": \"ËÆìÊàëÈÅ∏ÊôÇÈñì\",\n        \"data\": \"drug_datetime=selecttime drug_type_tmp={{$json.drug_type_tmp}} drug_number_tmp={{$json.drug_number}}\",\n        \"mode\": \"datetime\",\n        \"initial\": \"{{$now.format('yyyy-MM-dd')}}T{{$now.format('HH:mm')}}\",\n        \"max\": \"{{$now.plus(1, 'days').format('yyyy-MM-dd')}}T00:00\",\n        \"min\": \"{{$now.minus(10, 'days').format('yyyy-MM-dd')}}T00:00\"\n      }\n    ]\n  }\n}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1580, 3860],
      "id": "0bb24fbf-4605-485c-9f47-e4cf81f6bfb2",
      "name": "Set Drug DateTime"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "467ec0f2-bcfa-4dc3-9a7d-f5f708bcad18",
              "name": "drug_type",
              "value": "={{ $('Switch1').item.json.drug_type_tmp }}",
              "type": "string"
            },
            {
              "id": "06d005d7-3e7b-412f-9e51-4b90385b5f9e",
              "name": "drug_number",
              "value": "={{ $('Switch1').item.json.drug_number_tmp }}",
              "type": "string"
            },
            {
              "id": "91bb2ed6-949f-4a0a-a0fc-725d208e0d22",
              "name": "drug_datetime",
              "value": "={{ $json.drug_datetime }}",
              "type": "string"
            },
            {
              "id": "d5b2e09e-4ad0-4c74-bbba-703a97b32655",
              "name": "user_id",
              "value": "={{ $('Webhook').first().json.body.events.first().source.userId }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1580, 4020],
      "id": "1a6bac9d-7fa1-456c-a085-7f2e352871b1",
      "name": "Set Drug Usage"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"replyToken\":  \"{{ $('Webhook').item.json.body.events[0].replyToken }}\",\n  \"messages\":[{\n  \"type\": \"text\",\n  \"text\": \"È†≠ÁóõÂø´È£õüò≠ {{ $json.drug_datetime }} ÂêÉ‰∫Ü {{ $json.drug_number }} {{ $json.drug_type }}\"\n}\n]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [2040, 4020],
      "id": "f8a56b36-4648-44e1-827b-af9f3c4f992a",
      "name": "Response Success",
      "credentials": {
        "httpBearerAuth": {
          "id": "iNt070KxORzF3SpI",
          "name": "Line Auth Token"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"replyToken\":  \"{{ $('Webhook').first().json.body.events[0].replyToken }}\",\n  \"messages\":[{\n  \"type\": \"text\",\n  \"text\": {{ $json.formattedOutput }}\n}\n]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [480, 5000],
      "id": "b4ae0726-3e3c-47bf-95d8-53d27fa97b7c",
      "name": "Response Success1",
      "credentials": {
        "httpBearerAuth": {
          "id": "iNt070KxORzF3SpI",
          "name": "Line Auth Token"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1366a377-4f67-4f9f-9304-89d8859906fb",
              "name": "message",
              "value": "={\n  \"type\": \"flex\",\n  \"altText\": \"ÁèæÂú®È†≠ÊúâÂπæÂàÜÁóõ\",\n  \"contents\": {\n      \"type\": \"bubble\",\n      \"hero\": {\n        \"type\": \"image\",\n        \"size\": \"full\",\n        \"aspectRatio\": \"1:1\",\n        \"aspectMode\": \"cover\",\n        \"action\": {\n          \"type\": \"uri\",\n          \"uri\": \"https://line.me/\"\n        },\n        \"url\": \"https://storage.morningstella.com/api/v1/buckets/public/objects/download?preview=true&prefix=rate.png&version_id=null\"\n      },\n      \"body\": {\n        \"type\": \"box\",\n        \"layout\": \"vertical\",\n        \"spacing\": \"md\",\n        \"contents\": [\n          {\n            \"type\": \"text\",\n            \"text\": \"È†≠ÁóõÂπæÂàÜ\",\n            \"weight\": \"bold\",\n            \"size\": \"xl\",\n            \"align\": \"center\"\n          },\n          {\n            \"type\": \"text\",\n            \"text\": \"ÁèæÂú®ÂπæÂàÜÁóõ\",\n            \"size\": \"md\",\n            \"color\": \"#aaaaaa\",\n            \"align\": \"center\"\n          }\n        ]\n      },\n      \"footer\": {\n        \"type\": \"box\",\n        \"layout\": \"vertical\",\n        \"spacing\": \"sm\",\n        \"contents\": [\n          {\n            \"type\": \"box\",\n            \"layout\": \"horizontal\",\n            \"spacing\": \"sm\",\n            \"contents\": [\n              {\n                \"type\": \"button\",\n                \"action\": {\n                  \"type\": \"postback\",\n                  \"label\": \"1\",\n                  \"text\": \"1 ÂàÜÁóõ\",\n                  \"data\": \"pain_level=1 headache_occur_tmp={{$json.headache_occur}}\"\n                },\n                \"style\": \"primary\",\n                \"color\": \"#91D3FA\",\n                \"height\": \"sm\"\n              },\n              {\n                \"type\": \"button\",\n                \"action\": {\n                  \"type\": \"postback\",\n                  \"label\": \"2\",\n                  \"text\": \"2 ÂàÜÁóõ\",\n                  \"data\": \"pain_level=2 headache_occur_tmp={{$json.headache_occur}}\"\n                },\n                \"style\": \"primary\",\n                \"color\": \"#76C9F9\",\n                \"height\": \"sm\"\n              },\n              {\n                \"type\": \"button\",\n                \"action\": {\n                  \"type\": \"postback\",\n                  \"label\": \"3\",\n                  \"text\": \"3 ÂàÜÁóõ\",\n                  \"data\": \"pain_level=3 headache_occur_tmp={{$json.headache_occur}}\"\n                },\n                \"style\": \"primary\",\n                \"color\": \"#5CBEF7\",\n                \"height\": \"sm\"\n              }\n            ]\n          },\n          {\n            \"type\": \"box\",\n            \"layout\": \"horizontal\",\n            \"spacing\": \"sm\",\n            \"contents\": [\n              {\n                \"type\": \"button\",\n                \"action\": {\n                  \"type\": \"postback\",\n                  \"text\": \"4 ÂàÜÁóõ\",\n                  \"label\": \"4\",\n                  \"data\": \"pain_level=4 headache_occur_tmp={{$json.headache_occur}}\"\n                },\n                \"style\": \"primary\",\n                \"color\": \"#41B3F6\",\n                \"height\": \"sm\"\n              },\n              {\n                \"type\": \"button\",\n                \"action\": {\n                  \"type\": \"postback\",\n                  \"text\": \"5 ÂàÜÁóõ\",\n                  \"label\": \"5\",\n                  \"data\": \"pain_level=5 headache_occur_tmp={{$json.headache_occur}}\"\n                },\n                \"style\": \"primary\",\n                \"color\": \"#26A9F4\",\n                \"height\": \"sm\"\n              },\n              {\n                \"type\": \"button\",\n                \"action\": {\n                  \"type\": \"postback\",\n                  \"text\": \"6 ÂàÜÁóõ\",\n                  \"label\": \"6\",\n                  \"data\": \"pain_level=6 headache_occur_tmp={{$json.headache_occur}}\"\n                },\n                \"style\": \"primary\",\n                \"color\": \"#0B9EF3\",\n                \"height\": \"sm\"\n              }\n            ]\n          },\n          {\n            \"type\": \"box\",\n            \"layout\": \"horizontal\",\n            \"spacing\": \"sm\",\n            \"contents\": [\n              {\n                \"type\": \"button\",\n                \"action\": {\n                  \"type\": \"postback\",\n                  \"text\": \"7 ÂàÜÁóõ\",\n                  \"label\": \"7\",\n                  \"data\": \"pain_level=7 headache_occur_tmp={{$json.headache_occur}}\"\n                },\n                \"style\": \"primary\",\n                \"color\": \"#0A83CA\",\n                \"height\": \"sm\"\n              },\n              {\n                \"type\": \"button\",\n                \"action\": {\n                  \"type\": \"postback\",\n                  \"text\": \"8 ÂàÜÁóõ\",\n                  \"label\": \"8\",\n                  \"data\": \"pain_level=8 headache_occur_tmp={{$json.headache_occur}}\"\n                },\n                \"style\": \"primary\",\n                \"color\": \"#0869A0\",\n                \"height\": \"sm\"\n              },\n              {\n                \"type\": \"button\",\n                \"action\": {\n                  \"type\": \"postback\",\n                  \"text\": \"9 ÂàÜÁóõ\",\n                  \"label\": \"9\",\n                  \"data\": \"pain_level=9 headache_occur_tmp={{$json.headache_occur}}\"\n                },\n                \"style\": \"primary\",\n                \"color\": \"#064E76\",\n                \"height\": \"sm\"\n              }\n            ]\n          },\n          {\n            \"type\": \"box\",\n            \"layout\": \"horizontal\",\n            \"spacing\": \"sm\",\n            \"margin\": \"md\",\n            \"contents\": [\n              {\n                \"type\": \"button\",\n                \"action\": {\n                  \"type\": \"postback\",\n                  \"text\": \"Ë∂ÖÁ¥öÁÑ°ÊïµÁóõ\",\n                  \"label\": \"‚àû\",\n                  \"data\": \"pain_level=infinite headache_occur_tmp={{$json.headache_occur}}\"\n                },\n                \"style\": \"primary\",\n                \"color\": \"#FF4500\",\n                \"height\": \"sm\"\n              },\n              {\n                \"type\": \"button\",\n                \"action\": {\n                  \"type\": \"postback\",\n                  \"text\": \"ÊïëÊïëÊàë...\",\n                  \"label\": \"help\",\n                  \"data\": \"pain_level=help\"\n                },\n                \"style\": \"primary\",\n                \"height\": \"sm\",\n                \"color\": \"#FF4500\"\n              }\n            ]\n          }\n        ]\n      }\n    }\n}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1860, 4400],
      "id": "9469ebe2-ac66-4886-8711-b997fc96a1b6",
      "name": "Set Ask Headache Level"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2ff0b5c5-cbe4-4411-b947-cb0c743e30ee",
              "name": "pain_level",
              "value": "={{ $json.pain_level }}",
              "type": "string"
            },
            {
              "id": "fb60b723-f225-4590-9bc9-5357c4d39250",
              "name": "headache_occur",
              "value": "={{ $json.headache_occur_tmp }}",
              "type": "string"
            },
            {
              "id": "883b78ac-f64b-4afc-a867-31f79bf9f6cc",
              "name": "existed_headache_where",
              "value": "",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1580, 4180],
      "id": "387f665d-b98d-4ce1-a5b9-08695b14075f",
      "name": "Set Pain Level"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"replyToken\":  \"{{ $('Webhook').item.json.body.events[0].replyToken }}\",\n  \"messages\":[{\n  \"type\": \"text\",\n  \"text\": \"Âú® {{ $json.headache_occur }} Âá∫Áèæ‰∫Ü {{ $json.pain_level }} Á¥öÈ†≠Áóõ\"\n}\n]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [3140, 3660],
      "id": "464d7fb1-1af8-417d-b9f9-8135ed1d81c1",
      "name": "Response Success2",
      "credentials": {
        "httpBearerAuth": {
          "id": "iNt070KxORzF3SpI",
          "name": "Line Auth Token"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "let data = $input.all();\nlet formattedOutput = \"\";\nfor (let i = 0; i < data.length; i++) {\n  const entry = data[i].json;\n  console.log(entry)\n  formattedOutput += `Âú® ${entry.drug_datetime} ÂêÉ‰∫Ü ${\"üíä\".repeat(entry.drug_number)} ${entry.drug_type}`;\n  \n  // Add newline if not the last element\n  if (i < data.length - 1) {\n    formattedOutput += '\\n';\n  }\n}\n\nformattedOutput = JSON.stringify(formattedOutput)\nreturn {formattedOutput}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [280, 5000],
      "id": "888f4980-8001-4c7a-8fbc-e153c289779c",
      "name": "Code1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4bd62c6c-fc23-4108-ad16-74c8366cc27b",
              "name": "message",
              "value": "={\n  \"type\": \"template\",\n  \"altText\": \"‰ªÄÈ∫ºÊôÇÂÄôÈ†≠ÁóõÁöÑ?\",\n  \"template\": {\n    \"type\": \"buttons\",\n    \"thumbnailImageUrl\": \"https://storage.morningstella.com/api/v1/buckets/public/objects/download?preview=true&prefix=general_questions.png&version_id=null\",\n    \"imageAspectRatio\": \"square\",\n    \"title\": \"‰ªÄÈ∫ºÊôÇÂÄô?\",\n    \"text\": \"ÈÅ∏ÊìáÈ†≠ÁóõÊôÇÈñì\",\n    \"actions\": [\n      {\n        \"type\": \"postback\",\n        \"label\": \"Â∞±ÊòØÁèæÂú®ÔºåÁóõÊ≠ª\",\n        \"text\": \"Â∞±ÊòØÁèæÂú®\",\n        \"data\": \"headache_occur=now\"\n      },\n      {\n        \"type\": \"datetimepicker\",\n        \"label\": \"ËÆìÊàëÈÅ∏ÊôÇÈñì\",\n        \"data\": \"headache_occur=selecttime\",\n        \"mode\": \"datetime\",\n        \"initial\": \"{{$now.format('yyyy-MM-dd')}}T{{$now.format('HH:mm')}}\",\n        \"max\": \"{{$now.plus(1, 'days').format('yyyy-MM-dd')}}T00:00\",\n        \"min\": \"{{$now.minus(10, 'days').format('yyyy-MM-dd')}}T00:00\"\n      }\n    ]\n  }\n}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [-260, 4920],
      "id": "b0d8ad48-2568-4569-8dc8-9d08bd0ab058",
      "name": "Set Headache When"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e294c37d-c089-43ea-bacd-0e5e4e089bac",
              "name": "headache_occur",
              "value": "={{ $('Webhook').item.json.body.events[0].postback.params.datetime }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1580, 4500],
      "id": "8a4747e1-0bde-4349-b23e-4007c7b26159",
      "name": "Set Select Occur Time"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ceb5e266-ed7d-4da9-84eb-2340ebe85914",
              "name": "headache_occur",
              "value": "={{ $now.format('yyyy-MM-dd') }}T{{ $now.format('HH:mm') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1580, 4340],
      "id": "ab2c595d-8257-474c-9dfc-2a38c10c099d",
      "name": "Set Now Occur Time"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "88ea8471-364f-42c6-a5ad-5241e9cdc82c",
              "name": "message",
              "value": "={\n  \"type\": \"template\",\n  \"altText\": \"Êé°Âèñ‰ªÄÈ∫ºË°åÂãï?\",\n  \"template\": {\n    \"type\": \"carousel\",\n    \"imageAspectRatio\": \"square\",\n    \"columns\": [\n      {\n        \"thumbnailImageUrl\": \"https://storage.morningstella.com/api/v1/buckets/public/objects/download?preview=true&prefix=acupucture.png&version_id=null\",\n        \"title\": \"ÈáùÁÅ∏\",\n        \"text\": \"ÈáùÁÅ∏Â•ΩÁó†QQ\",\n        \"actions\": [\n          {\n            \"type\": \"postback\",\n            \"label\": \"ÁèæÂú®\",\n            \"text\": \"ÁèæÂú®Ê≠£Âú®ÈáùÁÅ∏QQ\",\n            \"data\": \"action=needle action_occur=now\"\n          },\n          {\n            \"type\": \"datetimepicker\",\n            \"label\": \"ÈÅ∏ÊìáÊôÇÈñì\",\n            \"data\": \"action=needle action_occur=selecttime\",\n            \"mode\": \"datetime\",\n            \"initial\": \"{{$now.format('yyyy-MM-dd')}}T{{$now.format('HH:mm')}}\",\n            \"max\": \"{{$now.plus(1, 'days').format('yyyy-MM-dd')}}T00:00\",\n            \"min\": \"{{$now.minus(10, 'days').format('yyyy-MM-dd')}}T00:00\"\n          }\n        ]\n      },\n      {\n        \"thumbnailImageUrl\": \"https://storage.morningstella.com/api/v1/buckets/public/objects/download?preview=true&prefix=hot_shower.png&version_id=null\",\n        \"title\": \"Ê≤ñÁÜ±Ê∞¥\",\n        \"text\": \"Ê≤ñÁÜ±Ê∞¥Â•ΩËàíÊúç~\",\n        \"actions\": [\n          {\n            \"type\": \"postback\",\n            \"label\": \"ÁèæÂú®\",\n            \"text\": \"ÂâõÊ≤ñÂÆåÁÜ±Ê∞¥\",\n            \"data\": \"action=shower action_occur=now\"\n          },\n          {\n            \"type\": \"datetimepicker\",\n            \"label\": \"ÈÅ∏ÊìáÊôÇÈñì\",\n            \"data\": \"action=shower action_occur=selecttime\",\n            \"mode\": \"datetime\",\n            \"initial\": \"{{$now.format('yyyy-MM-dd')}}T{{$now.format('HH:mm')}}\",\n            \"max\": \"{{$now.plus(1, 'days').format('yyyy-MM-dd')}}T00:00\",\n            \"min\": \"{{$now.minus(10, 'days').format('yyyy-MM-dd')}}T00:00\"\n          }\n        ]\n      },\n      {\n        \"thumbnailImageUrl\": \"https://storage.morningstella.com/api/v1/buckets/public/objects/download?preview=true&prefix=sleep.png&version_id=null\",\n        \"title\": \"Áù°Ë¶∫\",\n        \"text\": \"Zzzzzzzzz\",\n        \"actions\": [\n          {\n            \"type\": \"postback\",\n            \"label\": \"ÊàëÁèæÂú®Â∞±Ë¶ÅÁù°\",\n            \"text\": \"ÂÄíÈ†≠Â∞±Áù°\",\n            \"data\": \"action=sleep action_occur=now\"\n          },\n          {\n            \"type\": \"datetimepicker\",\n            \"label\": \"ÈÅ∏ÊìáÊôÇÈñì\",\n            \"data\": \"action=sleep action_occur=selecttime\",\n            \"mode\": \"datetime\",\n            \"initial\": \"{{$now.format('yyyy-MM-dd')}}T{{$now.format('HH:mm')}}\",\n            \"max\": \"{{$now.plus(1, 'days').format('yyyy-MM-dd')}}T00:00\",\n            \"min\": \"{{$now.minus(10, 'days').format('yyyy-MM-dd')}}T00:00\"\n          }\n        ],\n        \"imageBackgroundColor\": \"#EA8B8B\"\n      },\n      {\n        \"thumbnailImageUrl\": \"https://storage.morningstella.com/api/v1/buckets/public/objects/download?preview=true&prefix=massage.png&version_id=null\",\n        \"title\": \"ÊåâÊë©„ÄÅÊåâÁ©¥ÈÅì\",\n        \"text\": \"ÊåâÊë©...\",\n        \"actions\": [\n          {\n            \"type\": \"postback\",\n            \"label\": \"Ê≠£Âú®Êåâ\",\n            \"text\": \"Ê≠£Âú®Âä™ÂäõÊåâ\",\n            \"data\": \"action=massage action_occur=now\"\n          },\n          {\n            \"type\": \"datetimepicker\",\n            \"label\": \"ÈÅ∏ÊìáÊôÇÈñì\",\n            \"data\": \"action=massage action_occur=selecttime\",\n            \"mode\": \"datetime\",\n            \"initial\": \"{{$now.format('yyyy-MM-dd')}}T{{$now.format('HH:mm')}}\",\n            \"max\": \"{{$now.plus(1, 'days').format('yyyy-MM-dd')}}T00:00\",\n            \"min\": \"{{$now.minus(10, 'days').format('yyyy-MM-dd')}}T00:00\"\n          }\n        ],\n        \"imageBackgroundColor\": \"#EA8B8B\"\n      }\n    ]\n  }\n}\n",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [-360, 5180],
      "id": "fdde5559-9cda-45e4-97c3-1c18eb81b273",
      "name": "Set Action When"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f3356d60-de4d-4d63-b680-18661816e4ec",
              "name": "occur_time",
              "value": "={{ $now.format('yyyy-MM-dd') }}T{{ $now.format('HH:mm') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1580, 4700],
      "id": "ce899024-135c-4e38-bb64-6fb9cfe465b1",
      "name": "Set Action Occur Now"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "21fa4b2e-a105-4f0c-9356-d1427a6af645",
              "name": "action",
              "value": "={{ $('Switch1').item.json.action }}",
              "type": "string"
            },
            {
              "id": "f0b49273-5745-401b-8c0e-6b69e9352c39",
              "name": "occur_time",
              "value": "={{ $json.occur_time }}",
              "type": "string"
            },
            {
              "id": "46d9674c-84b2-497d-872c-302f19ac2beb",
              "name": "user_id",
              "value": "={{ $('Webhook').first().json.body.events.first().source.userId }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1980, 4840],
      "id": "5510e2fa-c9f7-44db-a8df-d62023b330d9",
      "name": "Set Action Insertion Data"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ca3258a0-bb80-42d9-9daa-32c4ba210e41",
              "name": "occur_time",
              "value": "={{ $('Webhook').item.json.body.events[0].postback.params.datetime }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1580, 4920],
      "id": "58108960-8fbe-4c23-88ab-effae9a5c103",
      "name": "Set Action Select Time"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"replyToken\":  \"{{ $('Webhook').item.json.body.events[0].replyToken }}\",\n  \"messages\":[{\n  \"type\": \"text\",\n  \"text\": \"Â∏åÊúõÈ†≠ÁóõÂèØ‰ª•ËàíÁ∑©ü•∫\"\n}\n]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [2380, 4840],
      "id": "da1d6ae3-a1c2-4a07-960c-70fe80871be7",
      "name": "Response Action",
      "credentials": {
        "httpBearerAuth": {
          "id": "iNt070KxORzF3SpI",
          "name": "Line Auth Token"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a3294e08-8654-446d-ba62-1a9d27fcdace",
              "name": "message",
              "value": "={\n    \"type\": \"template\",\n    \"altText\": \"‰ªÄÈ∫ºÊôÇÂÄô‰∏çÁóõÁöÑ?\",\n    \"template\": {\n      \"type\": \"buttons\",\n      \"thumbnailImageUrl\": \"https://storage.morningstella.com/api/v1/buckets/public/objects/download?preview=true&prefix=general_questions.png&version_id=null\",\n      \"imageAspectRatio\": \"square\",\n      \"title\": \"‰ªÄÈ∫ºÊôÇÂÄô‰∏çÁóõ‰∫Ü?\",\n      \"text\": \"ÊÅ≠Âñú‰Ω†!\",\n      \"actions\": [\n        {\n          \"type\": \"postback\",\n          \"label\": \"ÁèæÂú®‰∏çÁóõ‰∫Ü\",\n          \"text\": \"ÁèæÂú®‰∏çÁóõ‰∫Ü\",\n          \"data\": \"no_headache_occur=now\"\n        },\n        {\n          \"type\": \"datetimepicker\",\n          \"label\": \"ÈÅ∏ÊìáÊôÇÈñì\",\n          \"data\": \"no_headache_occur=selecttime\",\n          \"mode\": \"datetime\",\n          \"initial\": \"{{$now.format('yyyy-MM-dd')}}T{{$now.format('HH:mm')}}\",\n          \"max\": \"{{$now.plus(1, 'days').format('yyyy-MM-dd')}}T00:00\",\n          \"min\": \"{{$now.minus(10, 'days').format('yyyy-MM-dd')}}T00:00\"\n         }\n      ]\n    }\n  }",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [-360, 5360],
      "id": "45b256bf-8f46-4c10-9b9c-df4328dd31f4",
      "name": "Set No Headache When"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9b5e6717-e940-4739-b294-4b41f35be790",
              "name": "no_headache_time",
              "value": "={{$now.format('yyyy-MM-dd')}}T{{ $now.format('HH:mm') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1580, 5140],
      "id": "38fe54bc-79d1-4706-a5cb-fe3b4c18e8ef",
      "name": "Set No Headache Now"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "887c6e00-e6e0-44a0-92d8-5f293059fd66",
              "name": "headache_occur",
              "value": "={{ $json.no_headache_time }}",
              "type": "string"
            },
            {
              "id": "c1f9b6b1-a41f-4349-ad5f-eed9a0cf2ce6",
              "name": "pain_level",
              "value": "0",
              "type": "string"
            },
            {
              "id": "2c6c5940-b436-474c-bee0-62dfe82eaf42",
              "name": "user_id",
              "value": "={{ $('Webhook').first().json.body.events.first().source.userId }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1960, 5140],
      "id": "3c499629-f2ea-440d-b486-e587673d5853",
      "name": "Set No Headache Insert Data"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"replyToken\":  \"{{ $('Webhook').item.json.body.events[0].replyToken }}\",\n  \"messages\":[{\n  \"type\": \"text\",\n  \"text\": \"ÊÅ≠Âñú‰Ω†Âú® {{ $json.headache_occur }} È†≠‰∏çÁóõÂï¶ üòä\"\n}\n]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [2520, 5140],
      "id": "4cbb96c4-9341-4854-bbea-30391fd7eff8",
      "name": "Response Success3",
      "credentials": {
        "httpBearerAuth": {
          "id": "iNt070KxORzF3SpI",
          "name": "Line Auth Token"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9b5e6717-e940-4739-b294-4b41f35be790",
              "name": "no_headache_time",
              "value": "={{ $('Webhook').item.json.body.events[0].postback.params.datetime }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1580, 5400],
      "id": "08fc8974-7435-4bff-9fbe-983a910b8870",
      "name": "Set No Headache Select Time"
    },
    {
      "parameters": {
        "content": "## Set Pain Level\n",
        "height": 180,
        "width": 320,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [2520, 3620],
      "id": "0bf9e043-7942-4334-b16b-dfc38d2b02cd",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d9342c09-16cd-45be-a326-96a0006928a8",
              "name": "message",
              "value": "={\n  \"type\": \"flex\",\n  \"altText\": \"Âì™Ë£°È†≠Áóõ\",\n  \"contents\": {\n      \"type\": \"bubble\",\n      \"hero\": {\n        \"type\": \"image\",\n        \"size\": \"full\",\n        \"aspectRatio\": \"1:1\",\n        \"aspectMode\": \"cover\",\n        \"url\": \"https://storage.morningstella.com/api/v1/buckets/public/objects/download?preview=true&prefix=ache_part.png&version_id=null\",\n        \"action\": {\n          \"type\": \"uri\",\n          \"uri\": \"https://line.me/\"\n        }\n      },\n      \"body\": {\n        \"type\": \"box\",\n        \"layout\": \"vertical\",\n        \"spacing\": \"md\",\n        \"contents\": [\n          {\n            \"type\": \"text\",\n            \"text\": \"È†≠ÁóõÈÉ®‰Ωç\",\n            \"weight\": \"bold\",\n            \"size\": \"xl\",\n            \"align\": \"center\"\n          },\n          {\n            \"type\": \"text\",\n            \"text\": \"Ë´ãÈÅ∏ÊìáÁõÆÂâçÈ†≠ÁóõÁöÑÈÉ®‰Ωç\",\n            \"size\": \"md\",\n            \"color\": \"#aaaaaa\",\n            \"align\": \"center\"\n          }\n        ]\n      },\n      \"footer\": {\n        \"type\": \"box\",\n        \"layout\": \"vertical\",\n        \"spacing\": \"sm\",\n        \"contents\": [\n          {\n            \"type\": \"box\",\n            \"layout\": \"horizontal\",\n            \"spacing\": \"sm\",\n            \"contents\": [\n              {\n                \"type\": \"button\",\n                \"action\": {\n                  \"type\": \"postback\",\n                  \"label\": \"Â∑¶ÁúºÁ™©\",\n                  \"text\": \"Â∑¶ÁúºÁ™©Áóõ\",\n                  \"data\": \"headache_where=Â∑¶ÁúºÁ™©;{{$json.existed_headache_where}} pain_level_tmp={{$json.pain_level}} headache_occur_tmp={{$json.headache_occur}}\"\n                },\n                \"style\": \"primary\",\n                \"color\": \"#5CBEF7\",\n                \"height\": \"sm\"\n              },\n              {\n                \"type\": \"button\",\n                \"action\": {\n                  \"type\": \"postback\",\n                  \"label\": \"Âè≥ÁúºÁ™©\",\n                  \"text\": \"Âè≥ÁúºÁ™©Áóõ\",\n                  \"data\": \"headache_where=Âè≥ÁúºÁ™©;{{$json.existed_headache_where}} pain_level_tmp={{$json.pain_level}} headache_occur_tmp={{$json.headache_occur}}\"\n                },\n                \"style\": \"primary\",\n                \"color\": \"#5CBEF7\",\n                \"height\": \"sm\"\n              }\n            ]\n          },\n          {\n            \"type\": \"box\",\n            \"layout\": \"horizontal\",\n            \"spacing\": \"sm\",\n            \"contents\": [\n              {\n                \"type\": \"button\",\n                \"action\": {\n                  \"type\": \"postback\",\n                  \"label\": \"Â∑¶ÈÇäÂ§™ÈôΩÁ©¥\",\n                  \"text\": \"Â∑¶ÈÇäÂ§™ÈôΩÁ©¥Áóõ\",\n                  \"data\": \"headache_where=Â∑¶ÈÇäÂ§™ÈôΩÁ©¥;{{$json.existed_headache_where}} pain_level_tmp={{$json.pain_level}} headache_occur_tmp={{$json.headache_occur}}\"\n                },\n                \"style\": \"primary\",\n                \"color\": \"#41B3F6\",\n                \"height\": \"sm\"\n              },\n              {\n                \"type\": \"button\",\n                \"action\": {\n                  \"type\": \"postback\",\n                  \"label\": \"Âè≥ÈÇäÂ§™ÈôΩÁ©¥\",\n                  \"text\": \"Âè≥ÈÇäÂ§™ÈôΩÁ©¥Áóõ\",\n                  \"data\": \"headache_where=Âè≥ÈÇäÂ§™ÈôΩÁ©¥;{{$json.existed_headache_where}} pain_level_tmp={{$json.pain_level}} headache_occur_tmp={{$json.headache_occur}}\"\n                },\n                \"style\": \"primary\",\n                \"color\": \"#41B3F6\",\n                \"height\": \"sm\"\n              }\n            ]\n          },\n          {\n            \"type\": \"box\",\n            \"layout\": \"horizontal\",\n            \"spacing\": \"sm\",\n            \"contents\": [\n              {\n                \"type\": \"button\",\n                \"action\": {\n                  \"type\": \"postback\",\n                  \"label\": \"Â∑¶ËÇ©ËÜÄ\",\n                  \"text\": \"Â∑¶ËÇ©ËÜÄÁóõ\",\n                  \"data\": \"headache_where=Â∑¶ËÇ©ËÜÄ;{{$json.existed_headache_where}} pain_level_tmp={{$json.pain_level}} headache_occur_tmp={{$json.headache_occur}}\"\n                },\n                \"style\": \"primary\",\n                \"color\": \"#0B9EF3\",\n                \"height\": \"sm\"\n              },\n              {\n                \"type\": \"button\",\n                \"action\": {\n                  \"type\": \"postback\",\n                  \"label\": \"Âè≥ËÇ©ËÜÄ\",\n                  \"text\": \"Âè≥ËÇ©ËÜÄÁóõ\",\n                  \"data\": \"headache_where=Âè≥ËÇ©ËÜÄ;{{$json.existed_headache_where}} pain_level_tmp={{$json.pain_level}} headache_occur_tmp={{$json.headache_occur}}\"\n                },\n                \"style\": \"primary\",\n                \"color\": \"#0B9EF3\",\n                \"height\": \"sm\"\n              }\n            ]\n          },\n          {\n            \"type\": \"box\",\n            \"layout\": \"horizontal\",\n            \"spacing\": \"sm\",\n            \"contents\": [\n              {\n                \"type\": \"button\",\n                \"action\": {\n                  \"type\": \"postback\",\n                  \"label\": \"Â∑¶È†∏ÈÉ®\",\n                  \"text\": \"Â∑¶È†∏ÈÉ®Áóõ\",\n                  \"data\": \"headache_where=Â∑¶È†∏ÈÉ®;{{$json.existed_headache_where}} pain_level_tmp={{$json.pain_level}} headache_occur_tmp={{$json.headache_occur}}\"\n                },\n                \"style\": \"primary\",\n                \"color\": \"#0869A0\",\n                \"height\": \"sm\"\n              },\n              {\n                \"type\": \"button\",\n                \"action\": {\n                  \"type\": \"postback\",\n                  \"label\": \"Âè≥È†∏ÈÉ®\",\n                  \"text\": \"Âè≥È†∏ÈÉ®Áóõ\",\n                  \"data\": \"headache_where=Âè≥È†∏ÈÉ®;{{$json.existed_headache_where}} pain_level_tmp={{$json.pain_level}} headache_occur_tmp={{$json.headache_occur}}\"\n                },\n                \"style\": \"primary\",\n                \"color\": \"#0869A0\",\n                \"height\": \"sm\"\n              }\n            ]\n          },\n          {\n            \"type\": \"box\",\n            \"layout\": \"horizontal\",\n            \"spacing\": \"sm\",\n            \"margin\": \"md\",\n            \"contents\": [\n              {\n                \"type\": \"button\",\n                \"action\": {\n                  \"type\": \"postback\",\n                  \"text\": \"Ê≤íÊúâÂÖ∂‰ªñÂú∞ÊñπÁóõ‰∫Ü\",\n                  \"label\": \"Ê≤íÊúâÂÖ∂‰ªñÂú∞ÊñπÁóõ\",\n                  \"data\": \"headache_ask=done headache_where_final={{$json.existed_headache_where}} pain_level_tmp={{$json.pain_level}} headache_occur_tmp={{$json.headache_occur}}\"\n                },\n                \"style\": \"primary\",\n                \"color\": \"#32CD32\",\n                \"height\": \"sm\",\n                \"adjustMode\": \"shrink-to-fit\"\n              }\n            ]\n          }\n        ]\n      }\n    }\n}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1800, 4180],
      "id": "88b0b965-5610-41e9-a95e-be66789ca8e7",
      "name": "Set Ask Headache Where"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5a1b1fe6-a7f7-4c3e-b1b9-71c222fa6386",
              "name": "existed_headache_where",
              "value": "={{ $json.headache_where }}",
              "type": "string"
            },
            {
              "id": "c13011f9-18b1-4e46-baeb-45aa57927fcf",
              "name": "pain_level",
              "value": "={{ $json.pain_level_tmp }}",
              "type": "string"
            },
            {
              "id": "0b327f76-b8b6-4f17-b17d-7e78e4bdfe68",
              "name": "headache_occur",
              "value": "={{ $json.headache_occur_tmp }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1220, 4600],
      "id": "01adff84-4206-473b-aa9a-e8581067e335",
      "name": "Set Existed Headache Where"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4763c5c0-c839-46fb-bfa9-8f5a42150277",
              "name": "headache_where",
              "value": "={{ $json.headache_where_final }}",
              "type": "string"
            },
            {
              "id": "e1ccd62f-a92e-4c14-87a9-f4eea5031e9b",
              "name": "pain_level",
              "value": "={{ $json.pain_level_tmp }}",
              "type": "string"
            },
            {
              "id": "247b6223-91b0-4ff2-b78a-888170388eb8",
              "name": "headache_occur",
              "value": "={{ $json.headache_occur_tmp }}",
              "type": "string"
            },
            {
              "id": "f213afba-8746-4d79-aa23-25be12f8c870",
              "name": "user_id",
              "value": "={{ $('Webhook').first().json.body.events.first().source.userId }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1480, 3360],
      "id": "1e7d4a1a-9942-472d-b350-502d6594a330",
      "name": "Set Insert Ask Headache Data"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "t6pwOIMsfRwe7Pge",
          "mode": "list",
          "cachedResultName": "Write Headache Level Data"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [2380, 3560],
      "id": "c62ce49a-c5f8-4ddd-9724-a6139463de32",
      "name": "Write Headache Level"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "S8sAelRpoNS9PhiJ",
          "mode": "list",
          "cachedResultName": "Write Medicine Usage"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [1800, 4020],
      "id": "33bb46de-4ae1-42a9-90bf-4f85b17f0d5a",
      "name": "Write Medicine Usage"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "t6pwOIMsfRwe7Pge",
          "mode": "list",
          "cachedResultName": "Write Headache Level Data"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [2180, 5140],
      "id": "f20887e3-c479-45f4-92f1-415f39185a01",
      "name": "write no headache"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "bsww9kAb8DtrMO3f",
          "mode": "list",
          "cachedResultName": "List Latest Medicine Usage"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [-220, 5060],
      "id": "29eefd0e-3d03-450c-92a1-91e845d5ff87",
      "name": "Execute Workflow1"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "Aasdx41TvcrQ5Ca0",
          "mode": "list",
          "cachedResultName": "Write Action"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [2200, 4840],
      "id": "c22f4ce4-5561-4e4c-8382-c757944b35fd",
      "name": "Write Action"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "8dUOTyssWp1wjWUE",
          "mode": "list",
          "cachedResultName": "List Latest Headache"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [-400, 5600],
      "id": "ca7bdf67-2f26-4996-8a17-35d63e08f6b0",
      "name": "Execute Workflow"
    },
    {
      "parameters": {
        "jsCode": "let data = $input.all();\nlet formattedOutput = \"ÊúÄËøëÈ†≠ÁóõÁ¥ÄÈåÑüìù\\n\";\nfor (let i = 0; i < data.length; i++) {\n  const entry = data[i].json;\n  console.log(entry)\n  formattedOutput += `Âú® ${entry.headache_occur} ÁôºÁîü‰∫Ü ${entry.pain_level} Á¥öÈ†≠Áóõ‚ùó`;\n\n  if(entry.headache_where != null)\n  {\n    formattedOutput += `\\nÈ†≠ÁóõÈÉ®‰ΩçÂåÖÂê´${entry.headache_where.replace(/;$/, '')}`\n  }\n  \n  // Add newline if not the last element\n  if (i < data.length - 1) {\n    formattedOutput += '\\n';\n  }\n}\n\nformattedOutput = JSON.stringify(formattedOutput)\nreturn {formattedOutput}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-60, 5540],
      "id": "8fc45a2a-0fe9-4c86-bb91-a2cc61400d2e",
      "name": "Code2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "44b785b6-7f6a-4851-9d6d-08f317b8f9e4",
              "name": "drug_datetime",
              "value": "={{ $now.format('yyyy-MM-dd') }}T{{ $now.format('HH:mm') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1240, 4020],
      "id": "112d5e35-8bdc-46ee-a01e-bb44ff317f5d",
      "name": "Set Medicine Now"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "426cd249-9660-4ed4-bd7d-28c7d56d8519",
              "name": "drug_datetime",
              "value": "={{ $('Webhook').item.json.body.events[0].postback.params.datetime }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1260, 4220],
      "id": "1504aaf7-2a32-47e2-a564-4879913f0a66",
      "name": "Set Medicine SelectTime"
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Determine Response Action",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Drug Select": {
      "main": [
        [
          {
            "node": "Response Drug Select",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Determine Response Action": {
      "main": [
        [
          {
            "node": "Set Drug Select",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Headache When",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Execute Workflow1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Action When",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set No Headache When",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Execute Workflow",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Set Drug Number",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Drug DateTime",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Medicine Now",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Pain Level",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Now Occur Time",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Select Occur Time",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Action Occur Now",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Action Select Time",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set No Headache Now",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set No Headache Select Time",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Existed Headache Where",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Insert Ask Headache Data",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Medicine SelectTime",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Drug Number": {
      "main": [
        [
          {
            "node": "Response Drug Select",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Drug DateTime": {
      "main": [
        [
          {
            "node": "Response Drug Select",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Drug Usage": {
      "main": [
        [
          {
            "node": "Write Medicine Usage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Ask Headache Level": {
      "main": [
        [
          {
            "node": "Response Drug Select",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Pain Level": {
      "main": [
        [
          {
            "node": "Set Ask Headache Where",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "Response Success1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Headache When": {
      "main": [
        [
          {
            "node": "Response Drug Select",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Select Occur Time": {
      "main": [
        [
          {
            "node": "Set Ask Headache Level",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Now Occur Time": {
      "main": [
        [
          {
            "node": "Set Ask Headache Level",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Action When": {
      "main": [
        [
          {
            "node": "Response Drug Select",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Action Occur Now": {
      "main": [
        [
          {
            "node": "Set Action Insertion Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Action Insertion Data": {
      "main": [
        [
          {
            "node": "Write Action",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Action Select Time": {
      "main": [
        [
          {
            "node": "Set Action Insertion Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set No Headache When": {
      "main": [
        [
          {
            "node": "Response Drug Select",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set No Headache Now": {
      "main": [
        [
          {
            "node": "Set No Headache Insert Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set No Headache Insert Data": {
      "main": [
        [
          {
            "node": "write no headache",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set No Headache Select Time": {
      "main": [
        [
          {
            "node": "Set No Headache Insert Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Ask Headache Where": {
      "main": [
        [
          {
            "node": "Response Drug Select",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Existed Headache Where": {
      "main": [
        [
          {
            "node": "Set Ask Headache Where",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Insert Ask Headache Data": {
      "main": [
        [
          {
            "node": "Write Headache Level",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Write Headache Level": {
      "main": [
        [
          {
            "node": "Response Success2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Write Medicine Usage": {
      "main": [
        [
          {
            "node": "Response Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "write no headache": {
      "main": [
        [
          {
            "node": "Response Success3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Workflow1": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Write Action": {
      "main": [
        [
          {
            "node": "Response Action",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Workflow": {
      "main": [
        [
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "Response Success1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Medicine Now": {
      "main": [
        [
          {
            "node": "Set Drug Usage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Medicine SelectTime": {
      "main": [
        [
          {
            "node": "Set Drug Usage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "instanceId": "7474d84d2b834c864715cc1139cc946616c2310c4f45afb5a0945ca7fc78e0d9"
  }
}
